{"ast":null,"code":"import _defineProperty from\"/home/jordan/projects/djangoreactshop-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/home/jordan/projects/djangoreactshop-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/jordan/projects/djangoreactshop-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/jordan/projects/djangoreactshop-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/jordan/projects/djangoreactshop-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import{CardElement,injectStripe,Elements,StripeProvider}from\"react-stripe-elements\";import{Button,Container,Dimmer,Divider,Form,Header,Image,Item,Label,Loader,Message,Segment,Select}from\"semantic-ui-react\";import{Link,withRouter}from\"react-router-dom\";import{authAxios}from\"../utils\";import{checkoutURL,orderSummaryURL,addCouponURL,addressListURL}from\"../constants\";var OrderPreview=function OrderPreview(props){var data=props.data;return/*#__PURE__*/React.createElement(React.Fragment,null,data&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Item.Group,{relaxed:true},data.order_items.map(function(orderItem,i){return/*#__PURE__*/React.createElement(Item,{key:i},/*#__PURE__*/React.createElement(Item.Image,{size:\"tiny\",src:\"http://127.0.0.1:8000\".concat(orderItem.item.image)}),/*#__PURE__*/React.createElement(Item.Content,{verticalAlign:\"middle\"},/*#__PURE__*/React.createElement(Item.Header,{as:\"a\"},orderItem.quantity,\" x \",orderItem.item.title),/*#__PURE__*/React.createElement(Item.Extra,null,/*#__PURE__*/React.createElement(Label,null,\"$\",orderItem.final_price))));})),/*#__PURE__*/React.createElement(Item.Group,null,/*#__PURE__*/React.createElement(Item,null,/*#__PURE__*/React.createElement(Item.Content,null,/*#__PURE__*/React.createElement(Item.Header,null,\"Order Total: $\",data.total,data.coupon&&/*#__PURE__*/React.createElement(Label,{color:\"green\",style:{marginLeft:\"10px\"}},\"Current coupon: \",data.coupon.code,\" for $\",data.coupon.amount)))))));};var CouponForm=/*#__PURE__*/function(_Component){_inherits(CouponForm,_Component);var _super=_createSuper(CouponForm);function CouponForm(){var _this;_classCallCheck(this,CouponForm);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={code:\"\"};_this.handleChange=function(e){_this.setState({code:e.target.value});};_this.handleSubmit=function(e){var code=_this.state.code;_this.props.handleAddCoupon(e,code);_this.setState({code:\"\"});};return _this;}_createClass(CouponForm,[{key:\"render\",value:function render(){var code=this.state.code;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Form,{onSubmit:this.handleSubmit},/*#__PURE__*/React.createElement(Form.Field,null,/*#__PURE__*/React.createElement(\"label\",null,\"Coupon code\"),/*#__PURE__*/React.createElement(\"input\",{placeholder:\"Enter a coupon..\",value:code,onChange:this.handleChange})),/*#__PURE__*/React.createElement(Button,{type:\"submit\"},\"Submit\")));}}]);return CouponForm;}(Component);var CheckoutForm=/*#__PURE__*/function(_Component2){_inherits(CheckoutForm,_Component2);var _super2=_createSuper(CheckoutForm);function CheckoutForm(){var _this2;_classCallCheck(this,CheckoutForm);for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}_this2=_super2.call.apply(_super2,[this].concat(args));_this2.state={data:null,loading:false,error:null,success:false,shippingAddresses:[],billingAddresses:[],selectedBillingAddress:\"\",selectedShippingAddress:\"\"};_this2.handleGetDefaultAddress=function(addresses){var filteredAddresses=addresses.filter(function(el){return el.default===true;});if(filteredAddresses.length>0){return filteredAddresses[0].id;}return\"\";};_this2.handleFetchBillingAddresses=function(){_this2.setState({loading:true});authAxios.get(addressListURL(\"B\")).then(function(res){_this2.setState({billingAddresses:res.data.map(function(a){return{key:a.id,text:\"\".concat(a.street_address,\", \").concat(a.apartment_address,\", \").concat(a.country),value:a.id};}),selectedBillingAddress:_this2.handleGetDefaultAddress(res.data),loading:false});}).catch(function(err){_this2.setState({error:err,loading:false});});};_this2.handleFetchShippingAddresses=function(){_this2.setState({loading:true});authAxios.get(addressListURL(\"S\")).then(function(res){_this2.setState({shippingAddresses:res.data.map(function(a){return{key:a.id,text:\"\".concat(a.street_address,\", \").concat(a.apartment_address,\", \").concat(a.country),value:a.id};}),selectedShippingAddress:_this2.handleGetDefaultAddress(res.data),loading:false});}).catch(function(err){_this2.setState({error:err,loading:false});});};_this2.handleFetchOrder=function(){_this2.setState({loading:true});authAxios.get(orderSummaryURL).then(function(res){_this2.setState({data:res.data,loading:false});}).catch(function(err){if(err.response.status===404){_this2.props.history.push(\"/products\");}else{_this2.setState({error:err,loading:false});}});};_this2.handleAddCoupon=function(e,code){e.preventDefault();_this2.setState({loading:true});authAxios.post(addCouponURL,{code:code}).then(function(res){_this2.setState({loading:false});_this2.handleFetchOrder();}).catch(function(err){_this2.setState({error:err,loading:false});});};_this2.handleSelectChange=function(e,_ref){var name=_ref.name,value=_ref.value;_this2.setState(_defineProperty({},name,value));};_this2.submit=function(ev){ev.preventDefault();_this2.setState({loading:true});if(_this2.props.stripe){_this2.props.stripe.createToken().then(function(result){if(result.error){_this2.setState({error:result.error.message,loading:false});}else{_this2.setState({error:null});var _this2$state=_this2.state,selectedBillingAddress=_this2$state.selectedBillingAddress,selectedShippingAddress=_this2$state.selectedShippingAddress;authAxios.post(checkoutURL,{stripeToken:result.token.id,selectedBillingAddress:selectedBillingAddress,selectedShippingAddress:selectedShippingAddress}).then(function(res){_this2.setState({loading:false,success:true});}).catch(function(err){_this2.setState({loading:false,error:err});});}});}else{console.log(\"Stripe is not loaded\");}};return _this2;}_createClass(CheckoutForm,[{key:\"componentDidMount\",value:function componentDidMount(){this.handleFetchOrder();this.handleFetchBillingAddresses();this.handleFetchShippingAddresses();}},{key:\"render\",value:function render(){var _this3=this;var _this$state=this.state,data=_this$state.data,error=_this$state.error,loading=_this$state.loading,success=_this$state.success,billingAddresses=_this$state.billingAddresses,shippingAddresses=_this$state.shippingAddresses,selectedBillingAddress=_this$state.selectedBillingAddress,selectedShippingAddress=_this$state.selectedShippingAddress;return/*#__PURE__*/React.createElement(\"div\",null,error&&/*#__PURE__*/React.createElement(Message,{error:true,header:\"There was some errors with your submission\",content:JSON.stringify(error)}),loading&&/*#__PURE__*/React.createElement(Segment,null,/*#__PURE__*/React.createElement(Dimmer,{active:true,inverted:true},/*#__PURE__*/React.createElement(Loader,{inverted:true},\"Loading\")),/*#__PURE__*/React.createElement(Image,{src:\"/images/wireframe/short-paragraph.png\"})),/*#__PURE__*/React.createElement(OrderPreview,{data:data}),/*#__PURE__*/React.createElement(Divider,null),/*#__PURE__*/React.createElement(CouponForm,{handleAddCoupon:function handleAddCoupon(e,code){return _this3.handleAddCoupon(e,code);}}),/*#__PURE__*/React.createElement(Divider,null),/*#__PURE__*/React.createElement(Header,null,\"Select a billing address\"),billingAddresses.length>0?/*#__PURE__*/React.createElement(Select,{name:\"selectedBillingAddress\",value:selectedBillingAddress,clearable:true,options:billingAddresses,selection:true,onChange:this.handleSelectChange}):/*#__PURE__*/React.createElement(\"p\",null,\"You need to \",/*#__PURE__*/React.createElement(Link,{to:\"/profile\"},\"add a billing address\")),/*#__PURE__*/React.createElement(Header,null,\"Select a shipping address\"),shippingAddresses.length>0?/*#__PURE__*/React.createElement(Select,{name:\"selectedShippingAddress\",value:selectedShippingAddress,clearable:true,options:shippingAddresses,selection:true,onChange:this.handleSelectChange}):/*#__PURE__*/React.createElement(\"p\",null,\"You need to \",/*#__PURE__*/React.createElement(Link,{to:\"/profile\"},\"add a shipping address\")),/*#__PURE__*/React.createElement(Divider,null),billingAddresses.length<1||shippingAddresses.length<1?/*#__PURE__*/React.createElement(\"p\",null,\"You need to add addresses before you can complete your purchase\"):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Header,null,\"Would you like to complete the purchase?\"),/*#__PURE__*/React.createElement(CardElement,null),success&&/*#__PURE__*/React.createElement(Message,{positive:true},/*#__PURE__*/React.createElement(Message.Header,null,\"Your payment was successful\"),/*#__PURE__*/React.createElement(\"p\",null,\"Go to your \",/*#__PURE__*/React.createElement(\"b\",null,\"profile\"),\" to see the order delivery status.\")),/*#__PURE__*/React.createElement(Button,{loading:loading,disabled:loading,primary:true,onClick:this.submit,style:{marginTop:\"10px\"}},\"Submit\")));}}]);return CheckoutForm;}(Component);var InjectedForm=withRouter(injectStripe(CheckoutForm));var WrappedForm=function WrappedForm(){return/*#__PURE__*/React.createElement(Container,{text:true},/*#__PURE__*/React.createElement(StripeProvider,{apiKey:\"\"},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h1\",null,\"Complete your order\"),/*#__PURE__*/React.createElement(Elements,null,/*#__PURE__*/React.createElement(InjectedForm,null)))));};export default WrappedForm;","map":{"version":3,"sources":["/home/jordan/projects/djangoreactshop-main/src/containers/Checkout.js"],"names":["React","Component","CardElement","injectStripe","Elements","StripeProvider","Button","Container","Dimmer","Divider","Form","Header","Image","Item","Label","Loader","Message","Segment","Select","Link","withRouter","authAxios","checkoutURL","orderSummaryURL","addCouponURL","addressListURL","OrderPreview","props","data","order_items","map","orderItem","i","item","image","quantity","title","final_price","total","coupon","marginLeft","code","amount","CouponForm","state","handleChange","e","setState","target","value","handleSubmit","handleAddCoupon","CheckoutForm","loading","error","success","shippingAddresses","billingAddresses","selectedBillingAddress","selectedShippingAddress","handleGetDefaultAddress","addresses","filteredAddresses","filter","el","default","length","id","handleFetchBillingAddresses","get","then","res","a","key","text","street_address","apartment_address","country","catch","err","handleFetchShippingAddresses","handleFetchOrder","response","status","history","push","preventDefault","post","handleSelectChange","name","submit","ev","stripe","createToken","result","message","stripeToken","token","console","log","JSON","stringify","marginTop","InjectedForm","WrappedForm"],"mappings":"uxBAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,OACEC,WADF,CAEEC,YAFF,CAGEC,QAHF,CAIEC,cAJF,KAKO,uBALP,CAMA,OACEC,MADF,CAEEC,SAFF,CAGEC,MAHF,CAIEC,OAJF,CAKEC,IALF,CAMEC,MANF,CAOEC,KAPF,CAQEC,IARF,CASEC,KATF,CAUEC,MAVF,CAWEC,OAXF,CAYEC,OAZF,CAaEC,MAbF,KAcO,mBAdP,CAeA,OAASC,IAAT,CAAeC,UAAf,KAAiC,kBAAjC,CACA,OAASC,SAAT,KAA0B,UAA1B,CACA,OACEC,WADF,CAEEC,eAFF,CAGEC,YAHF,CAIEC,cAJF,KAKO,cALP,CAOA,GAAMC,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAAAC,KAAK,CAAI,IACpBC,CAAAA,IADoB,CACXD,KADW,CACpBC,IADoB,CAE5B,mBACE,oBAAC,KAAD,CAAO,QAAP,MACGA,IAAI,eACH,oBAAC,KAAD,CAAO,QAAP,mBACE,oBAAC,IAAD,CAAM,KAAN,EAAY,OAAO,KAAnB,EACGA,IAAI,CAACC,WAAL,CAAiBC,GAAjB,CAAqB,SAACC,SAAD,CAAYC,CAAZ,CAAkB,CACtC,mBACE,oBAAC,IAAD,EAAM,GAAG,CAAEA,CAAX,eACE,oBAAC,IAAD,CAAM,KAAN,EACE,IAAI,CAAC,MADP,CAEE,GAAG,gCAA0BD,SAAS,CAACE,IAAV,CAAeC,KAAzC,CAFL,EADF,cAKE,oBAAC,IAAD,CAAM,OAAN,EAAc,aAAa,CAAC,QAA5B,eACE,oBAAC,IAAD,CAAM,MAAN,EAAa,EAAE,CAAC,GAAhB,EACGH,SAAS,CAACI,QADb,OAC0BJ,SAAS,CAACE,IAAV,CAAeG,KADzC,CADF,cAIE,oBAAC,IAAD,CAAM,KAAN,mBACE,oBAAC,KAAD,UAASL,SAAS,CAACM,WAAnB,CADF,CAJF,CALF,CADF,CAgBD,CAjBA,CADH,CADF,cAsBE,oBAAC,IAAD,CAAM,KAAN,mBACE,oBAAC,IAAD,mBACE,oBAAC,IAAD,CAAM,OAAN,mBACE,oBAAC,IAAD,CAAM,MAAN,uBACiBT,IAAI,CAACU,KADtB,CAEGV,IAAI,CAACW,MAAL,eACC,oBAAC,KAAD,EAAO,KAAK,CAAC,OAAb,CAAqB,KAAK,CAAE,CAAEC,UAAU,CAAE,MAAd,CAA5B,qBACmBZ,IAAI,CAACW,MAAL,CAAYE,IAD/B,UAEGb,IAAI,CAACW,MAAL,CAAYG,MAFf,CAHJ,CADF,CADF,CADF,CAtBF,CAFJ,CADF,CA4CD,CA9CD,C,GAgDMC,CAAAA,U,2UACJC,K,CAAQ,CACNH,IAAI,CAAE,EADA,C,OAIRI,Y,CAAe,SAAAC,CAAC,CAAI,CAClB,MAAKC,QAAL,CAAc,CACZN,IAAI,CAAEK,CAAC,CAACE,MAAF,CAASC,KADH,CAAd,EAGD,C,OAEDC,Y,CAAe,SAAAJ,CAAC,CAAI,IACVL,CAAAA,IADU,CACD,MAAKG,KADJ,CACVH,IADU,CAElB,MAAKd,KAAL,CAAWwB,eAAX,CAA2BL,CAA3B,CAA8BL,IAA9B,EACA,MAAKM,QAAL,CAAc,CAAEN,IAAI,CAAE,EAAR,CAAd,EACD,C,6EAEQ,IACCA,CAAAA,IADD,CACU,KAAKG,KADf,CACCH,IADD,CAEP,mBACE,oBAAC,KAAD,CAAO,QAAP,mBACE,oBAAC,IAAD,EAAM,QAAQ,CAAE,KAAKS,YAArB,eACE,oBAAC,IAAD,CAAM,KAAN,mBACE,+CADF,cAEE,6BACE,WAAW,CAAC,kBADd,CAEE,KAAK,CAAET,IAFT,CAGE,QAAQ,CAAE,KAAKI,YAHjB,EAFF,CADF,cASE,oBAAC,MAAD,EAAQ,IAAI,CAAC,QAAb,WATF,CADF,CADF,CAeD,C,wBAlCsB5C,S,KAqCnBmD,CAAAA,Y,mWACJR,K,CAAQ,CACNhB,IAAI,CAAE,IADA,CAENyB,OAAO,CAAE,KAFH,CAGNC,KAAK,CAAE,IAHD,CAINC,OAAO,CAAE,KAJH,CAKNC,iBAAiB,CAAE,EALb,CAMNC,gBAAgB,CAAE,EANZ,CAONC,sBAAsB,CAAE,EAPlB,CAQNC,uBAAuB,CAAE,EARnB,C,QAiBRC,uB,CAA0B,SAAAC,SAAS,CAAI,CACrC,GAAMC,CAAAA,iBAAiB,CAAGD,SAAS,CAACE,MAAV,CAAiB,SAAAC,EAAE,QAAIA,CAAAA,EAAE,CAACC,OAAH,GAAe,IAAnB,EAAnB,CAA1B,CACA,GAAIH,iBAAiB,CAACI,MAAlB,CAA2B,CAA/B,CAAkC,CAChC,MAAOJ,CAAAA,iBAAiB,CAAC,CAAD,CAAjB,CAAqBK,EAA5B,CACD,CACD,MAAO,EAAP,CACD,C,QAEDC,2B,CAA8B,UAAM,CAClC,OAAKrB,QAAL,CAAc,CAAEM,OAAO,CAAE,IAAX,CAAd,EACAhC,SAAS,CACNgD,GADH,CACO5C,cAAc,CAAC,GAAD,CADrB,EAEG6C,IAFH,CAEQ,SAAAC,GAAG,CAAI,CACX,OAAKxB,QAAL,CAAc,CACZU,gBAAgB,CAAEc,GAAG,CAAC3C,IAAJ,CAASE,GAAT,CAAa,SAAA0C,CAAC,CAAI,CAClC,MAAO,CACLC,GAAG,CAAED,CAAC,CAACL,EADF,CAELO,IAAI,WAAKF,CAAC,CAACG,cAAP,cAA0BH,CAAC,CAACI,iBAA5B,cAAkDJ,CAAC,CAACK,OAApD,CAFC,CAGL5B,KAAK,CAAEuB,CAAC,CAACL,EAHJ,CAAP,CAKD,CANiB,CADN,CAQZT,sBAAsB,CAAE,OAAKE,uBAAL,CAA6BW,GAAG,CAAC3C,IAAjC,CARZ,CASZyB,OAAO,CAAE,KATG,CAAd,EAWD,CAdH,EAeGyB,KAfH,CAeS,SAAAC,GAAG,CAAI,CACZ,OAAKhC,QAAL,CAAc,CAAEO,KAAK,CAAEyB,GAAT,CAAc1B,OAAO,CAAE,KAAvB,CAAd,EACD,CAjBH,EAkBD,C,QAED2B,4B,CAA+B,UAAM,CACnC,OAAKjC,QAAL,CAAc,CAAEM,OAAO,CAAE,IAAX,CAAd,EACAhC,SAAS,CACNgD,GADH,CACO5C,cAAc,CAAC,GAAD,CADrB,EAEG6C,IAFH,CAEQ,SAAAC,GAAG,CAAI,CACX,OAAKxB,QAAL,CAAc,CACZS,iBAAiB,CAAEe,GAAG,CAAC3C,IAAJ,CAASE,GAAT,CAAa,SAAA0C,CAAC,CAAI,CACnC,MAAO,CACLC,GAAG,CAAED,CAAC,CAACL,EADF,CAELO,IAAI,WAAKF,CAAC,CAACG,cAAP,cAA0BH,CAAC,CAACI,iBAA5B,cAAkDJ,CAAC,CAACK,OAApD,CAFC,CAGL5B,KAAK,CAAEuB,CAAC,CAACL,EAHJ,CAAP,CAKD,CANkB,CADP,CAQZR,uBAAuB,CAAE,OAAKC,uBAAL,CAA6BW,GAAG,CAAC3C,IAAjC,CARb,CASZyB,OAAO,CAAE,KATG,CAAd,EAWD,CAdH,EAeGyB,KAfH,CAeS,SAAAC,GAAG,CAAI,CACZ,OAAKhC,QAAL,CAAc,CAAEO,KAAK,CAAEyB,GAAT,CAAc1B,OAAO,CAAE,KAAvB,CAAd,EACD,CAjBH,EAkBD,C,QAED4B,gB,CAAmB,UAAM,CACvB,OAAKlC,QAAL,CAAc,CAAEM,OAAO,CAAE,IAAX,CAAd,EACAhC,SAAS,CACNgD,GADH,CACO9C,eADP,EAEG+C,IAFH,CAEQ,SAAAC,GAAG,CAAI,CACX,OAAKxB,QAAL,CAAc,CAAEnB,IAAI,CAAE2C,GAAG,CAAC3C,IAAZ,CAAkByB,OAAO,CAAE,KAA3B,CAAd,EACD,CAJH,EAKGyB,KALH,CAKS,SAAAC,GAAG,CAAI,CACZ,GAAIA,GAAG,CAACG,QAAJ,CAAaC,MAAb,GAAwB,GAA5B,CAAiC,CAC/B,OAAKxD,KAAL,CAAWyD,OAAX,CAAmBC,IAAnB,CAAwB,WAAxB,EACD,CAFD,IAEO,CACL,OAAKtC,QAAL,CAAc,CAAEO,KAAK,CAAEyB,GAAT,CAAc1B,OAAO,CAAE,KAAvB,CAAd,EACD,CACF,CAXH,EAYD,C,QAEDF,e,CAAkB,SAACL,CAAD,CAAIL,IAAJ,CAAa,CAC7BK,CAAC,CAACwC,cAAF,GACA,OAAKvC,QAAL,CAAc,CAAEM,OAAO,CAAE,IAAX,CAAd,EACAhC,SAAS,CACNkE,IADH,CACQ/D,YADR,CACsB,CAAEiB,IAAI,CAAJA,IAAF,CADtB,EAEG6B,IAFH,CAEQ,SAAAC,GAAG,CAAI,CACX,OAAKxB,QAAL,CAAc,CAAEM,OAAO,CAAE,KAAX,CAAd,EACA,OAAK4B,gBAAL,GACD,CALH,EAMGH,KANH,CAMS,SAAAC,GAAG,CAAI,CACZ,OAAKhC,QAAL,CAAc,CAAEO,KAAK,CAAEyB,GAAT,CAAc1B,OAAO,CAAE,KAAvB,CAAd,EACD,CARH,EASD,C,QAEDmC,kB,CAAqB,SAAC1C,CAAD,MAAwB,IAAlB2C,CAAAA,IAAkB,MAAlBA,IAAkB,CAAZxC,KAAY,MAAZA,KAAY,CAC3C,OAAKF,QAAL,oBAAiB0C,IAAjB,CAAwBxC,KAAxB,GACD,C,QAEDyC,M,CAAS,SAAAC,EAAE,CAAI,CACbA,EAAE,CAACL,cAAH,GACA,OAAKvC,QAAL,CAAc,CAAEM,OAAO,CAAE,IAAX,CAAd,EACA,GAAI,OAAK1B,KAAL,CAAWiE,MAAf,CAAuB,CACrB,OAAKjE,KAAL,CAAWiE,MAAX,CAAkBC,WAAlB,GAAgCvB,IAAhC,CAAqC,SAAAwB,MAAM,CAAI,CAC7C,GAAIA,MAAM,CAACxC,KAAX,CAAkB,CAChB,OAAKP,QAAL,CAAc,CAAEO,KAAK,CAAEwC,MAAM,CAACxC,KAAP,CAAayC,OAAtB,CAA+B1C,OAAO,CAAE,KAAxC,CAAd,EACD,CAFD,IAEO,CACL,OAAKN,QAAL,CAAc,CAAEO,KAAK,CAAE,IAAT,CAAd,EADK,iBAKD,OAAKV,KALJ,CAGHc,sBAHG,cAGHA,sBAHG,CAIHC,uBAJG,cAIHA,uBAJG,CAMLtC,SAAS,CACNkE,IADH,CACQjE,WADR,CACqB,CACjB0E,WAAW,CAAEF,MAAM,CAACG,KAAP,CAAa9B,EADT,CAEjBT,sBAAsB,CAAtBA,sBAFiB,CAGjBC,uBAAuB,CAAvBA,uBAHiB,CADrB,EAMGW,IANH,CAMQ,SAAAC,GAAG,CAAI,CACX,OAAKxB,QAAL,CAAc,CAAEM,OAAO,CAAE,KAAX,CAAkBE,OAAO,CAAE,IAA3B,CAAd,EACD,CARH,EASGuB,KATH,CASS,SAAAC,GAAG,CAAI,CACZ,OAAKhC,QAAL,CAAc,CAAEM,OAAO,CAAE,KAAX,CAAkBC,KAAK,CAAEyB,GAAzB,CAAd,EACD,CAXH,EAYD,CACF,CAtBD,EAuBD,CAxBD,IAwBO,CACLmB,OAAO,CAACC,GAAR,CAAY,sBAAZ,EACD,CACF,C,sGA1HmB,CAClB,KAAKlB,gBAAL,GACA,KAAKb,2BAAL,GACA,KAAKY,4BAAL,GACD,C,uCAwHQ,iCAUH,KAAKpC,KAVF,CAELhB,IAFK,aAELA,IAFK,CAGL0B,KAHK,aAGLA,KAHK,CAILD,OAJK,aAILA,OAJK,CAKLE,OALK,aAKLA,OALK,CAMLE,gBANK,aAMLA,gBANK,CAOLD,iBAPK,aAOLA,iBAPK,CAQLE,sBARK,aAQLA,sBARK,CASLC,uBATK,aASLA,uBATK,CAYP,mBACE,+BACGL,KAAK,eACJ,oBAAC,OAAD,EACE,KAAK,KADP,CAEE,MAAM,CAAC,4CAFT,CAGE,OAAO,CAAE8C,IAAI,CAACC,SAAL,CAAe/C,KAAf,CAHX,EAFJ,CAQGD,OAAO,eACN,oBAAC,OAAD,mBACE,oBAAC,MAAD,EAAQ,MAAM,KAAd,CAAe,QAAQ,KAAvB,eACE,oBAAC,MAAD,EAAQ,QAAQ,KAAhB,YADF,CADF,cAIE,oBAAC,KAAD,EAAO,GAAG,CAAC,uCAAX,EAJF,CATJ,cAiBE,oBAAC,YAAD,EAAc,IAAI,CAAEzB,IAApB,EAjBF,cAkBE,oBAAC,OAAD,MAlBF,cAmBE,oBAAC,UAAD,EACE,eAAe,CAAE,yBAACkB,CAAD,CAAIL,IAAJ,QAAa,CAAA,MAAI,CAACU,eAAL,CAAqBL,CAArB,CAAwBL,IAAxB,CAAb,EADnB,EAnBF,cAsBE,oBAAC,OAAD,MAtBF,cAuBE,oBAAC,MAAD,iCAvBF,CAwBGgB,gBAAgB,CAACS,MAAjB,CAA0B,CAA1B,cACC,oBAAC,MAAD,EACE,IAAI,CAAC,wBADP,CAEE,KAAK,CAAER,sBAFT,CAGE,SAAS,KAHX,CAIE,OAAO,CAAED,gBAJX,CAKE,SAAS,KALX,CAME,QAAQ,CAAE,KAAK+B,kBANjB,EADD,cAUC,yDACc,oBAAC,IAAD,EAAM,EAAE,CAAC,UAAT,0BADd,CAlCJ,cAsCE,oBAAC,MAAD,kCAtCF,CAuCGhC,iBAAiB,CAACU,MAAlB,CAA2B,CAA3B,cACC,oBAAC,MAAD,EACE,IAAI,CAAC,yBADP,CAEE,KAAK,CAAEP,uBAFT,CAGE,SAAS,KAHX,CAIE,OAAO,CAAEH,iBAJX,CAKE,SAAS,KALX,CAME,QAAQ,CAAE,KAAKgC,kBANjB,EADD,cAUC,yDACc,oBAAC,IAAD,EAAM,EAAE,CAAC,UAAT,2BADd,CAjDJ,cAqDE,oBAAC,OAAD,MArDF,CAuDG/B,gBAAgB,CAACS,MAAjB,CAA0B,CAA1B,EAA+BV,iBAAiB,CAACU,MAAlB,CAA2B,CAA1D,cACC,+FADD,cAGC,oBAAC,KAAD,CAAO,QAAP,mBACE,oBAAC,MAAD,iDADF,cAEE,oBAAC,WAAD,MAFF,CAGGX,OAAO,eACN,oBAAC,OAAD,EAAS,QAAQ,KAAjB,eACE,oBAAC,OAAD,CAAS,MAAT,oCADF,cAEE,wDACa,uCADb,sCAFF,CAJJ,cAWE,oBAAC,MAAD,EACE,OAAO,CAAEF,OADX,CAEE,QAAQ,CAAEA,OAFZ,CAGE,OAAO,KAHT,CAIE,OAAO,CAAE,KAAKqC,MAJhB,CAKE,KAAK,CAAE,CAAEY,SAAS,CAAE,MAAb,CALT,WAXF,CA1DJ,CADF,CAmFD,C,0BAvOwBrG,S,EA0O3B,GAAMsG,CAAAA,YAAY,CAAGnF,UAAU,CAACjB,YAAY,CAACiD,YAAD,CAAb,CAA/B,CAEA,GAAMoD,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,sBAClB,oBAAC,SAAD,EAAW,IAAI,KAAf,eACE,oBAAC,cAAD,EAAgB,MAAM,CAAC,EAAvB,eACE,4CACE,oDADF,cAEE,oBAAC,QAAD,mBACE,oBAAC,YAAD,MADF,CAFF,CADF,CADF,CADkB,EAApB,CAaA,cAAeA,CAAAA,WAAf","sourcesContent":["import React, { Component } from \"react\";\nimport {\n  CardElement,\n  injectStripe,\n  Elements,\n  StripeProvider\n} from \"react-stripe-elements\";\nimport {\n  Button,\n  Container,\n  Dimmer,\n  Divider,\n  Form,\n  Header,\n  Image,\n  Item,\n  Label,\n  Loader,\n  Message,\n  Segment,\n  Select\n} from \"semantic-ui-react\";\nimport { Link, withRouter } from \"react-router-dom\";\nimport { authAxios } from \"../utils\";\nimport {\n  checkoutURL,\n  orderSummaryURL,\n  addCouponURL,\n  addressListURL\n} from \"../constants\";\n\nconst OrderPreview = props => {\n  const { data } = props;\n  return (\n    <React.Fragment>\n      {data && (\n        <React.Fragment>\n          <Item.Group relaxed>\n            {data.order_items.map((orderItem, i) => {\n              return (\n                <Item key={i}>\n                  <Item.Image\n                    size=\"tiny\"\n                    src={`http://127.0.0.1:8000${orderItem.item.image}`}\n                  />\n                  <Item.Content verticalAlign=\"middle\">\n                    <Item.Header as=\"a\">\n                      {orderItem.quantity} x {orderItem.item.title}\n                    </Item.Header>\n                    <Item.Extra>\n                      <Label>${orderItem.final_price}</Label>\n                    </Item.Extra>\n                  </Item.Content>\n                </Item>\n              );\n            })}\n          </Item.Group>\n\n          <Item.Group>\n            <Item>\n              <Item.Content>\n                <Item.Header>\n                  Order Total: ${data.total}\n                  {data.coupon && (\n                    <Label color=\"green\" style={{ marginLeft: \"10px\" }}>\n                      Current coupon: {data.coupon.code} for $\n                      {data.coupon.amount}\n                    </Label>\n                  )}\n                </Item.Header>\n              </Item.Content>\n            </Item>\n          </Item.Group>\n        </React.Fragment>\n      )}\n    </React.Fragment>\n  );\n};\n\nclass CouponForm extends Component {\n  state = {\n    code: \"\"\n  };\n\n  handleChange = e => {\n    this.setState({\n      code: e.target.value\n    });\n  };\n\n  handleSubmit = e => {\n    const { code } = this.state;\n    this.props.handleAddCoupon(e, code);\n    this.setState({ code: \"\" });\n  };\n\n  render() {\n    const { code } = this.state;\n    return (\n      <React.Fragment>\n        <Form onSubmit={this.handleSubmit}>\n          <Form.Field>\n            <label>Coupon code</label>\n            <input\n              placeholder=\"Enter a coupon..\"\n              value={code}\n              onChange={this.handleChange}\n            />\n          </Form.Field>\n          <Button type=\"submit\">Submit</Button>\n        </Form>\n      </React.Fragment>\n    );\n  }\n}\n\nclass CheckoutForm extends Component {\n  state = {\n    data: null,\n    loading: false,\n    error: null,\n    success: false,\n    shippingAddresses: [],\n    billingAddresses: [],\n    selectedBillingAddress: \"\",\n    selectedShippingAddress: \"\"\n  };\n\n  componentDidMount() {\n    this.handleFetchOrder();\n    this.handleFetchBillingAddresses();\n    this.handleFetchShippingAddresses();\n  }\n\n  handleGetDefaultAddress = addresses => {\n    const filteredAddresses = addresses.filter(el => el.default === true);\n    if (filteredAddresses.length > 0) {\n      return filteredAddresses[0].id;\n    }\n    return \"\";\n  };\n\n  handleFetchBillingAddresses = () => {\n    this.setState({ loading: true });\n    authAxios\n      .get(addressListURL(\"B\"))\n      .then(res => {\n        this.setState({\n          billingAddresses: res.data.map(a => {\n            return {\n              key: a.id,\n              text: `${a.street_address}, ${a.apartment_address}, ${a.country}`,\n              value: a.id\n            };\n          }),\n          selectedBillingAddress: this.handleGetDefaultAddress(res.data),\n          loading: false\n        });\n      })\n      .catch(err => {\n        this.setState({ error: err, loading: false });\n      });\n  };\n\n  handleFetchShippingAddresses = () => {\n    this.setState({ loading: true });\n    authAxios\n      .get(addressListURL(\"S\"))\n      .then(res => {\n        this.setState({\n          shippingAddresses: res.data.map(a => {\n            return {\n              key: a.id,\n              text: `${a.street_address}, ${a.apartment_address}, ${a.country}`,\n              value: a.id\n            };\n          }),\n          selectedShippingAddress: this.handleGetDefaultAddress(res.data),\n          loading: false\n        });\n      })\n      .catch(err => {\n        this.setState({ error: err, loading: false });\n      });\n  };\n\n  handleFetchOrder = () => {\n    this.setState({ loading: true });\n    authAxios\n      .get(orderSummaryURL)\n      .then(res => {\n        this.setState({ data: res.data, loading: false });\n      })\n      .catch(err => {\n        if (err.response.status === 404) {\n          this.props.history.push(\"/products\");\n        } else {\n          this.setState({ error: err, loading: false });\n        }\n      });\n  };\n\n  handleAddCoupon = (e, code) => {\n    e.preventDefault();\n    this.setState({ loading: true });\n    authAxios\n      .post(addCouponURL, { code })\n      .then(res => {\n        this.setState({ loading: false });\n        this.handleFetchOrder();\n      })\n      .catch(err => {\n        this.setState({ error: err, loading: false });\n      });\n  };\n\n  handleSelectChange = (e, { name, value }) => {\n    this.setState({ [name]: value });\n  };\n\n  submit = ev => {\n    ev.preventDefault();\n    this.setState({ loading: true });\n    if (this.props.stripe) {\n      this.props.stripe.createToken().then(result => {\n        if (result.error) {\n          this.setState({ error: result.error.message, loading: false });\n        } else {\n          this.setState({ error: null });\n          const {\n            selectedBillingAddress,\n            selectedShippingAddress\n          } = this.state;\n          authAxios\n            .post(checkoutURL, {\n              stripeToken: result.token.id,\n              selectedBillingAddress,\n              selectedShippingAddress\n            })\n            .then(res => {\n              this.setState({ loading: false, success: true });\n            })\n            .catch(err => {\n              this.setState({ loading: false, error: err });\n            });\n        }\n      });\n    } else {\n      console.log(\"Stripe is not loaded\");\n    }\n  };\n\n  render() {\n    const {\n      data,\n      error,\n      loading,\n      success,\n      billingAddresses,\n      shippingAddresses,\n      selectedBillingAddress,\n      selectedShippingAddress\n    } = this.state;\n\n    return (\n      <div>\n        {error && (\n          <Message\n            error\n            header=\"There was some errors with your submission\"\n            content={JSON.stringify(error)}\n          />\n        )}\n        {loading && (\n          <Segment>\n            <Dimmer active inverted>\n              <Loader inverted>Loading</Loader>\n            </Dimmer>\n            <Image src=\"/images/wireframe/short-paragraph.png\" />\n          </Segment>\n        )}\n\n        <OrderPreview data={data} />\n        <Divider />\n        <CouponForm\n          handleAddCoupon={(e, code) => this.handleAddCoupon(e, code)}\n        />\n        <Divider />\n        <Header>Select a billing address</Header>\n        {billingAddresses.length > 0 ? (\n          <Select\n            name=\"selectedBillingAddress\"\n            value={selectedBillingAddress}\n            clearable\n            options={billingAddresses}\n            selection\n            onChange={this.handleSelectChange}\n          />\n        ) : (\n          <p>\n            You need to <Link to=\"/profile\">add a billing address</Link>\n          </p>\n        )}\n        <Header>Select a shipping address</Header>\n        {shippingAddresses.length > 0 ? (\n          <Select\n            name=\"selectedShippingAddress\"\n            value={selectedShippingAddress}\n            clearable\n            options={shippingAddresses}\n            selection\n            onChange={this.handleSelectChange}\n          />\n        ) : (\n          <p>\n            You need to <Link to=\"/profile\">add a shipping address</Link>\n          </p>\n        )}\n        <Divider />\n\n        {billingAddresses.length < 1 || shippingAddresses.length < 1 ? (\n          <p>You need to add addresses before you can complete your purchase</p>\n        ) : (\n          <React.Fragment>\n            <Header>Would you like to complete the purchase?</Header>\n            <CardElement />\n            {success && (\n              <Message positive>\n                <Message.Header>Your payment was successful</Message.Header>\n                <p>\n                  Go to your <b>profile</b> to see the order delivery status.\n                </p>\n              </Message>\n            )}\n            <Button\n              loading={loading}\n              disabled={loading}\n              primary\n              onClick={this.submit}\n              style={{ marginTop: \"10px\" }}\n            >\n              Submit\n            </Button>\n          </React.Fragment>\n        )}\n      </div>\n    );\n  }\n}\n\nconst InjectedForm = withRouter(injectStripe(CheckoutForm));\n\nconst WrappedForm = () => (\n  <Container text>\n    <StripeProvider apiKey=\"\">\n      <div>\n        <h1>Complete your order</h1>\n        <Elements>\n          <InjectedForm />\n        </Elements>\n      </div>\n    </StripeProvider>\n  </Container>\n);\n\nexport default WrappedForm;\n"]},"metadata":{},"sourceType":"module"}